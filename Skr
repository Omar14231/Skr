-- Script for Roblox Flight, Speed, ESP, and Teleport GUI
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- GUI Creation
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MainGUI"
ScreenGui.Parent = player.PlayerGui

-- Main Toggle Button - Smaller size
local ToggleButton = Instance.new("ImageButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Image = "rbxassetid://113897764094984"
ToggleButton.Size = UDim2.new(0, 40, 0, 40) -- أصغر حجم
ToggleButton.Position = UDim2.new(0, 20, 0.5, -20)
ToggleButton.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
ToggleButton.BackgroundTransparency = 0.2
ToggleButton.BorderSizePixel = 0
ToggleButton.Parent = ScreenGui

-- Main Menu Frame - Full Height
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 350, 1, -40)
MainFrame.Position = UDim2.new(0, 20, 0, 20)
MainFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
MainFrame.BorderColor3 = Color3.new(0.3, 0.3, 0.3)
MainFrame.BorderSizePixel = 2
MainFrame.Visible = false
MainFrame.Parent = ScreenGui

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 35, 0, 35)
CloseButton.Position = UDim2.new(1, -40, 0, 10)
CloseButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
CloseButton.TextColor3 = Color3.new(1, 1, 1)
CloseButton.Text = "×"
CloseButton.TextSize = 24
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, -80, 0, 40)
Title.Position = UDim2.new(0, 10, 0, 10)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Text = "SKR"
Title.TextSize = 24
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = MainFrame

-- Scrolling Frame for Commands
local ScrollFrame = Instance.new("ScrollingFrame")
ScrollFrame.Name = "ScrollFrame"
ScrollFrame.Size = UDim2.new(1, -20, 1, -80)
ScrollFrame.Position = UDim2.new(0, 10, 0, 60)
ScrollFrame.BackgroundTransparency = 1
ScrollFrame.BorderSizePixel = 0
ScrollFrame.ScrollBarThickness = 6
ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 500)
ScrollFrame.Parent = MainFrame

-- Flight Feature
local FlightFrame = Instance.new("Frame")
FlightFrame.Name = "FlightFrame"
FlightFrame.Size = UDim2.new(1, 0, 0, 70)
FlightFrame.Position = UDim2.new(0, 0, 0, 10)
FlightFrame.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
FlightFrame.BorderSizePixel = 0
FlightFrame.Parent = ScrollFrame

local FlightLabel = Instance.new("TextLabel")
FlightLabel.Name = "FlightLabel"
FlightLabel.Size = UDim2.new(0, 200, 1, 0)
FlightLabel.Position = UDim2.new(0, 15, 0, 0)
FlightLabel.BackgroundTransparency = 1
FlightLabel.TextColor3 = Color3.new(1, 1, 1)
FlightLabel.Text = "طيران"
FlightLabel.TextSize = 18
FlightLabel.Font = Enum.Font.GothamBold
FlightLabel.TextXAlignment = Enum.TextXAlignment.Left
FlightLabel.Parent = FlightFrame

local FlightToggle = Instance.new("TextButton")
FlightToggle.Name = "FlightToggle"
FlightToggle.Size = UDim2.new(0, 80, 0, 35)
FlightToggle.Position = UDim2.new(1, -95, 0.5, -17.5)
FlightToggle.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
FlightToggle.TextColor3 = Color3.new(1, 1, 1)
FlightToggle.Text = "إقلاع"
FlightToggle.TextSize = 14
FlightToggle.Font = Enum.Font.Gotham
FlightToggle.Parent = FlightFrame

-- Speed Feature
local SpeedFrame = Instance.new("Frame")
SpeedFrame.Name = "SpeedFrame"
SpeedFrame.Size = UDim2.new(1, 0, 0, 100)
SpeedFrame.Position = UDim2.new(0, 0, 0, 90)
SpeedFrame.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
SpeedFrame.BorderSizePixel = 0
SpeedFrame.Parent = ScrollFrame

local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Name = "SpeedLabel"
SpeedLabel.Size = UDim2.new(1, -20, 0, 30)
SpeedLabel.Position = UDim2.new(0, 15, 0, 10)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.TextColor3 = Color3.new(1, 1, 1)
SpeedLabel.Text = "تزيد سرعته"
SpeedLabel.TextSize = 18
SpeedLabel.Font = Enum.Font.GothamBold
SpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
SpeedLabel.Parent = SpeedFrame

local SpeedTextBox = Instance.new("TextBox")
SpeedTextBox.Name = "SpeedTextBox"
SpeedTextBox.Size = UDim2.new(0, 120, 0, 35)
SpeedTextBox.Position = UDim2.new(0, 15, 0, 50)
SpeedTextBox.BackgroundColor3 = Color3.new(0.25, 0.25, 0.25)
SpeedTextBox.TextColor3 = Color3.new(1, 1, 1)
SpeedTextBox.PlaceholderText = "ادخل السرعة"
SpeedTextBox.Text = ""
SpeedTextBox.TextSize = 16
SpeedTextBox.Font = Enum.Font.Gotham
SpeedTextBox.Parent = SpeedFrame

local SpeedApply = Instance.new("TextButton")
SpeedApply.Name = "SpeedApply"
SpeedApply.Size = UDim2.new(0, 80, 0, 35)
SpeedApply.Position = UDim2.new(1, -95, 0, 50)
SpeedApply.BackgroundColor3 = Color3.new(0, 0.6, 0)
SpeedApply.TextColor3 = Color3.new(1, 1, 1)
SpeedApply.Text = "تطبيق"
SpeedApply.TextSize = 14
SpeedApply.Font = Enum.Font.Gotham
SpeedApply.Parent = SpeedFrame

-- ESP Feature
local ESPFrame = Instance.new("Frame")
ESPFrame.Name = "ESPFrame"
ESPFrame.Size = UDim2.new(1, 0, 0, 70)
ESPFrame.Position = UDim2.new(0, 0, 0, 200)
ESPFrame.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
ESPFrame.BorderSizePixel = 0
ESPFrame.Parent = ScrollFrame

local ESPLabel = Instance.new("TextLabel")
ESPLabel.Name = "ESPLabel"
ESPLabel.Size = UDim2.new(0, 200, 1, 0)
ESPLabel.Position = UDim2.new(0, 15, 0, 0)
ESPLabel.BackgroundTransparency = 1
ESPLabel.TextColor3 = Color3.new(1, 1, 1)
ESPLabel.Text = "رؤيت كل العيبه"
ESPLabel.TextSize = 18
ESPLabel.Font = Enum.Font.GothamBold
ESPLabel.TextXAlignment = Enum.TextXAlignment.Left
ESPLabel.Parent = ESPFrame

local ESPToggle = Instance.new("TextButton")
ESPToggle.Name = "ESPToggle"
ESPToggle.Size = UDim2.new(0, 80, 0, 35)
ESPToggle.Position = UDim2.new(1, -95, 0.5, -17.5)
ESPToggle.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
ESPToggle.TextColor3 = Color3.new(1, 1, 1)
ESPToggle.Text = "تشغيل"
ESPToggle.TextSize = 14
ESPToggle.Font = Enum.Font.Gotham
ESPToggle.Parent = ESPFrame

-- Teleport Feature
local TeleportFrame = Instance.new("Frame")
TeleportFrame.Name = "TeleportFrame"
TeleportFrame.Size = UDim2.new(1, 0, 0, 100)
TeleportFrame.Position = UDim2.new(0, 0, 0, 280)
TeleportFrame.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
TeleportFrame.BorderSizePixel = 0
TeleportFrame.Parent = ScrollFrame

local TeleportLabel = Instance.new("TextLabel")
TeleportLabel.Name = "TeleportLabel"
TeleportLabel.Size = UDim2.new(1, -20, 0, 30)
TeleportLabel.Position = UDim2.new(0, 15, 0, 10)
TeleportLabel.BackgroundTransparency = 1
TeleportLabel.TextColor3 = Color3.new(1, 1, 1)
TeleportLabel.Text = "انتقال"
TeleportLabel.TextSize = 18
TeleportLabel.Font = Enum.Font.GothamBold
TeleportLabel.TextXAlignment = Enum.TextXAlignment.Left
TeleportLabel.Parent = TeleportFrame

local TeleportTextBox = Instance.new("TextBox")
TeleportTextBox.Name = "TeleportTextBox"
TeleportTextBox.Size = UDim2.new(1, -30, 0, 35)
TeleportTextBox.Position = UDim2.new(0, 15, 0, 50)
TeleportTextBox.BackgroundColor3 = Color3.new(0.25, 0.25, 0.25)
TeleportTextBox.TextColor3 = Color3.new(1, 1, 1)
TeleportTextBox.PlaceholderText = "اسم اللاعب"
TeleportTextBox.Text = ""
TeleportTextBox.TextSize = 16
TeleportTextBox.Font = Enum.Font.Gotham
TeleportTextBox.Parent = TeleportFrame

-- Variables
local flying = false
local espEnabled = false
local bodyVelocity, bodyGyro
local espParts = {}

-- Toggle Button Dragging - محسن للزر الصغير
local dragging = false
local dragInput
local dragStart
local startPos

local function updateInput(input)
    local delta = input.Position - dragStart
    local newX = startPos.X.Offset + delta.X
    local newY = startPos.Y.Offset + delta.Y
    
    -- التأكد من أن الزر يبقى داخل الشاشة
    newX = math.clamp(newX, 0, ScreenGui.AbsoluteSize.X - ToggleButton.AbsoluteSize.X)
    newY = math.clamp(newY, 0, ScreenGui.AbsoluteSize.Y - ToggleButton.AbsoluteSize.Y)
    
    ToggleButton.Position = UDim2.new(0, newX, 0, newY)
end

ToggleButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = ToggleButton.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

ToggleButton.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        updateInput(input)
    end
end)

-- Toggle Menu
ToggleButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

CloseButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
end)

-- نظام الطيران الجديد - عند الضغط يختفي كل شيء ويعمل السكريبت
local function loadFlightScript()
    -- إخفاء كل واجهة المستخدم
    ScreenGui:Destroy()
    
    -- تشغيل سكريبت الطيران المتقدم
    loadstring("\108\111\97\100\115\116\114\105\110\103\40\103\97\109\101\58\72\116\116\112\71\101\116\40\40\39\104\116\116\112\115\58\47\47\103\105\115\116\46\103\105\116\104\117\98\117\115\101\114\99\111\110\116\101\110\116\46\99\111\109\47\109\101\111\122\111\110\101\89\84\47\98\102\48\51\55\100\102\102\57\102\48\97\55\48\48\49\55\51\48\52\100\100\100\54\55\102\100\99\100\51\55\48\47\114\97\119\47\101\49\52\101\55\52\102\52\50\53\98\48\54\48\100\102\53\50\51\51\52\51\99\102\51\48\98\55\56\55\48\55\52\101\98\51\99\53\100\50\47\97\114\99\101\117\115\37\50\53\50\48\120\37\50\53\50\48\102\108\121\37\50\53\50\48\50\37\50\53\50\48\111\98\102\108\117\99\97\116\111\114\39\41\44\116\114\117\101\41\41\40\41\10\10")()
end

FlightToggle.MouseButton1Click:Connect(loadFlightScript)

-- Speed System
SpeedApply.MouseButton1Click:Connect(function()
    local speedValue = tonumber(SpeedTextBox.Text)
    if speedValue and speedValue > 0 then
        local character = player.Character
        if character then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.WalkSpeed = speedValue
            end
        end
    end
end)

-- ESP System
local function createESP(targetPlayer)
    local character = targetPlayer.Character
    if not character then return end
    
    local highlight = Instance.new("Highlight")
    highlight.Name = "ESP_" .. targetPlayer.Name
    highlight.FillColor = Color3.new(math.random(), math.random(), math.random())
    highlight.OutlineColor = Color3.new(1, 1, 1)
    highlight.FillTransparency = 0.5
    highlight.OutlineTransparency = 0
    highlight.Parent = character
    highlight.Adornee = character
    
    espParts[targetPlayer] = highlight
end

local function removeESP(targetPlayer)
    if espParts[targetPlayer] then
        espParts[targetPlayer]:Destroy()
        espParts[targetPlayer] = nil
    end
end

local function toggleESP()
    espEnabled = not espEnabled
    
    if espEnabled then
        ESPToggle.Text = "إيقاف"
        ESPToggle.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
        
        -- Add ESP for existing players
        for _, otherPlayer in pairs(Players:GetPlayers()) do
            if otherPlayer ~= player then
                createESP(otherPlayer)
            end
        end
        
        -- Listen for new players
        Players.PlayerAdded:Connect(function(newPlayer)
            if espEnabled then
                createESP(newPlayer)
            end
        end)
        
        -- Listen for players leaving
        Players.PlayerRemoving:Connect(function(leavingPlayer)
            removeESP(leavingPlayer)
        end)
    else
        ESPToggle.Text = "تشغيل"
        ESPToggle.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
        
        -- Remove all ESP
        for targetPlayer, highlight in pairs(espParts) do
            highlight:Destroy()
        end
        espParts = {}
    end
end

ESPToggle.MouseButton1Click:Connect(toggleESP)

-- Teleport System
TeleportTextBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        local targetName = TeleportTextBox.Text
        if targetName == "" then return end
        
        for _, otherPlayer in pairs(Players:GetPlayers()) do
            if otherPlayer.Name:lower():find(targetName:lower()) or otherPlayer.DisplayName:lower():find(targetName:lower()) then
                local targetCharacter = otherPlayer.Character
                local localCharacter = player.Character
                
                if targetCharacter and localCharacter then
                    local targetRoot = targetCharacter:FindFirstChild("HumanoidRootPart")
                    local localRoot = localCharacter:FindFirstChild("HumanoidRootPart")
                    
                    if targetRoot and localRoot then
                        localRoot.CFrame = targetRoot.CFrame + Vector3.new(0, 3, 0)
                        break
                    end
                end
            end
        end
    end
end)

print("SKR Script loaded successfully!")
